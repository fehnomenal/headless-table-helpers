import{c as b,e as g,f as L} from"../index-c0b43c1dd129ca28.js";import{readonly as A} from"svelte/store";import{writable as y} from"svelte/store";function d(a,e){const o={rowsPerPage:a.rowsPerPage,rowsPerPageOptions:a.rowsPerPageOptions,sortable:a.sortable,currentPage:"loading",totalPages:"loading",totalRows:"loading",rows:[],isLoadingRows:!0,getParamsForSort:e,paramsForFirstPage:"loading",paramsForPreviousPage:"loading",paramsForNextPage:"loading",paramsForLastPage:"loading"};if(a.type==="offset")return y({...o,paramNames:a.paramNames,sort:a.sort});if(a.type==="cursor")return y({...o,paramNames:a.paramNames,sort:a.sort});return b(a)}var P=(a,e,o,t,n,i,r)=>{a.update((s)=>({...s,paramNames:e.paramNames,rowsPerPage:e.rowsPerPage,rowsPerPageOptions:e.rowsPerPageOptions,sort:e.sort,sortable:e.sortable,isLoadingRows:!0,getParamsForSort:o,paramsForFirstPage:t})),n.then((s)=>a.update((l)=>({...l,currentPage:s}))),i.then((s)=>a.update((l)=>({...l,totalPages:s}))),r.totalRows.then((s)=>a.update((l)=>({...l,totalRows:s}))),r.rows.then((s)=>a.update((l)=>({...l,rows:s,isLoadingRows:!1})))};var w=(a,e)=>Math.floor(a/e)+1,R=(a,e)=>Math.ceil(a/e),S=(a,e)=>(a-1)*e;var p=(a,e,o)=>(t)=>{const n=e?.field===t?e.dir:void 0,i=n?L(n):"asc";return new URLSearchParams([[a.paramNames.rowsPerPage,a.rowsPerPage.toString()],[a.paramNames.sort,g({field:t,dir:i})],...o.params])},c=(a)=>Object.entries(a?.additionalParams??{}).filter(([,e])=>!!e).map(([e,o])=>[e,String(o)]),T=(a)=>{if(!a.rowsPerPageOptions.includes(a.rowsPerPage))a.rowsPerPageOptions.push(a.rowsPerPage);a.rowsPerPageOptions.sort((e,o)=>e-o)},D=(a,e,o)=>{const t=e.currentOffset.then((i)=>w(i,a.rowsPerPage)),n=Promise.all([t,e.rows,e.totalRows]).then(async([i,r,s])=>{const l=R(s,a.rowsPerPage);if(o?.onTotalPages)await o.onTotalPages({currentPage:i,currentPageSize:r.length,totalPages:l,meta:a});return l});return{currentPage:t,totalPages:n}};var h=([a,e,o])=>{const t={params:[]},n=d(a,p(a,a.sort,t)),i=(r,s,l)=>{t.params=c(l),T(r);const{currentPage:C,totalPages:f}=D(r,s,l);P(n,r,p(r,r.sort,t),O(r,t,null,null),C,f,s),s.rows.then((m)=>n.update((u)=>({...u,paramsForPreviousPage:O(r,t,M(m[0],r),"before"),paramsForNextPage:O(r,t,M(m[m.length-1],r),"after")}))),s.lastPageCursor.then((m)=>n.update((u)=>({...u,paramsForLastPage:m===null?null:O(r,t,m,"after")})))};return i(a,e,o),{...A(n),update:i}},O=(a,e,o,t)=>{const n=new URLSearchParams([[a.paramNames.rowsPerPage,a.rowsPerPage.toString()],...e.params]);if(o)n.set(a.paramNames.cursorId,`${o.id}`);if(a.sort.field!==a.idColumn){if(n.set(a.paramNames.sort,g(a.sort)),o)n.set(a.paramNames.cursorSort,`${o.sort}`)}if(t)n.set(a.paramNames.direction,t);return n},M=(a,e)=>({id:a?.[e.idColumn],sort:a?.[e.sort.field]});import{readonly as F} from"svelte/store";var N=([a,e,o])=>{const t={params:[]},n=d(a,p(a,a.sort[0],t)),i=(r,s,l)=>{t.params=c(l),T(r);const{currentPage:C,totalPages:f}=D(r,s,l);return P(n,r,p(r,r.sort[0],t),x(r,t,1),C,f,s),C.then((m)=>n.update((u)=>({...u,paramsForPreviousPage:x(r,t,m-1),paramsForNextPage:x(r,t,m+1)}))),f.then((m)=>n.update((u)=>({...u,paramsForLastPage:x(r,t,m)}))),F(n)};return i(a,e,o),{...F(n),update:i}},x=(a,e,o)=>{const t=new URLSearchParams([[a.paramNames.rowsPerPage,a.rowsPerPage.toString()],...e.params]);if(o>1)t.set(a.paramNames.currentOffset,S(o,a.rowsPerPage).toString());for(let n of a.sort)t.append(a.paramNames.sort,g(n));return t};function ta(...a){if(U(a))return N(a);if(v(a))return h(a);return b(a)}var U=(a)=>a[0].type==="offset",v=(a)=>a[0].type==="cursor";export{ta as clientDataTable};
